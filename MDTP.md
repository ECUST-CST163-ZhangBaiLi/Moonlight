# MDTP 协议（Moonlight Data Transfer Protocol）

## 请求

1 byte = 8 bit

| 是否保持连接 | 方法     | 请求序列号   | 键的长度   | 键的内容             | 值的长度   | 值的内容             |
|--------|--------|---------|--------|------------------|--------|------------------|
| 1byte  | 1 byte | 4 byte  | 4 byte | 最大 2^31 - 1 byte | 4 byte | 最大 2^31 - 1 byte |

### 方法
| 方法值  | 方法名            | 说明                                   |
|------|----------------|--------------------------------------|
| 0x01 | set            | 若key不存在，新增key，否则更新key                |
| 0x02 | get            | 获取key                                |
| 0x03 | update         | 若key存在，更新key，否则报错（暂时不实现）             |
| 0x04 | delete         | 删除key                                |
| 0x05 | exit           | 退出客户端                                |
| 0x06 | system         | 设置系统变量，例如：`system binlog off`（暂时未实现） |
| 0x07 | cluster        | 查看集群相关的信息（暂时未实现）                     |
| 0x08 | ping           | 用于检测服务器是否正常工作                        |
| 0x09 | append_entries | 添加日志条目（集群模式，节点之间通信的请求方法）             |
| 0x0a | request_vote   | 请求投票（集群模式，节点之间通信的请求方法）               |

## 响应

| 是否保持连接 | 状态码    | 序列号    | 值的长度   | 值的内容             |
|--------|--------|--------|--------|------------------|
| 1 byte | 1 byte | 4 byte | 4 byte | 最大 2^31 - 1 byte |

### 状态码

| 状态码  | 名称                       | 说明                   |
|------|--------------------------|----------------------|
| 0x01 | `VALUE_EXIST`            | 值存在                  |
| 0x02 | `VALUE_NOT_EXIST`        | 值不存在                 |
| 0x03 | `SUCCESS_NO_VALUE`       | 请求成功，没有值返回（如：delete） |
| 0x04 | `ERROR`                  | 请求出错                 |
| 0x05 | `PONG`                   | ping命令的响应            |
| 0x06 | `GET_VOTE`               | 获取到投票                |
| 0x07 | `DID_NOT_GET_VOTE`       | 没有获取到投票              |
| 0x08 | `APPEND_ENTRIES_SUCCESS` | 追加日志成功               |
| 0x09 | `APPEND_ENTRIES_FAIL`    | 追加日志失败               |
